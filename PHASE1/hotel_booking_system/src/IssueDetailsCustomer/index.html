<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LuxuryStay - Issue Details</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>
<body class="bg-gray-50 flex flex-col min-h-screen">

  <!-- ✅ Navbar -->
  <div id="navbar"></div>

  <!-- ✅ Layout -->
  <div class="flex flex-1 max-w-7xl mx-auto w-full py-8 px-4 lg:px-8 gap-8 mt-20">

    <!-- ✅ Sidebar -->
    <aside class="w-64 bg-white shadow-lg rounded-2xl p-6 h-fit">
      <nav class="space-y-4 text-gray-700 font-medium">
        <a href="../MainPageCustomer/index.html" data-page="dashboard" class="block py-2 border-b hover:text-yellow-600">Overview</a>
        <a href="../MyBookings/index.html" data-page="booking" class="block py-2 border-b hover:text-yellow-600">My Bookings</a>
        <a href="../SavedRoomsCustomer/index.html" data-page="saved" class="block py-2 border-b hover:text-yellow-600">Wishlist</a>
        <a href="../MyIssues/index.html" data-page="issues" class="block py-2 border-b hover:text-yellow-600">My Issues</a>
        <a href="../MyRefunds/index.html" data-page="refunds" class="block py-2 border-b hover:text-yellow-600">My Refunds</a>
        <a href="../ProfileDisplayCustomer/index.html" data-page="profile" class="block py-2 border-b hover:text-yellow-600">Profile</a>
        <a href="../MyReports/index.html" data-page="report" class="block py-2 border-b hover:text-yellow-600">Reports</a>
      </nav>
    </aside>

<!-- ✅ Main Content -->
<main class="flex-1 space-y-10">

  <!-- ✅ Page Header -->
  <div class="relative rounded-2xl border-2 border-red-400 bg-[#fdfaf4] py-8 text-center shadow">
    <h2 class="text-4xl text-gray-800 font-bold">Issue Details</h2>
    <p class="text-gray-500 mt-2">Detailed view of a reported issue with media and chat</p>
  </div>

  <!-- ✅ Back Button -->
  <div class="flex justify-start">
    <button onclick="window.history.back()" 
      class="flex items-center gap-2 bg-gradient-to-r from-yellow-500 to-pink-500 text-white px-5 py-2 rounded-lg shadow hover:opacity-90">
      <span class="material-icons text-sm">arrow_back</span> Back
    </button>
  </div>

<!-- ✅ Issue Details (enhanced description + metadata + show more) -->
<section class="bg-white rounded-2xl border border-gray-200 p-6 shadow-md">
  <div class="md:flex md:items-start md:justify-between gap-6">
    <!-- Left: Main fields + large description -->
    <div class="md:flex-1">
      <h3 class="text-lg font-semibold text-yellow-700 mb-4">Issue Information</h3>

      <div class="grid sm:grid-cols-2 gap-4 mb-4 text-gray-700">
        <div>
          <p><span class="font-medium">Issue Title:</span> <span class="text-gray-900">Room Service Delay</span></p>
          <p class="mt-2"><span class="font-medium">Booking ID:</span> <span class="text-gray-900">1002</span></p>
          <p class="mt-2"><span class="font-medium">Room Number:</span> <span class="text-gray-900">302</span></p>
        </div>

        <div>
          <p><span class="font-medium">Reported By:</span> <span class="text-gray-900">Arjun Kumar</span></p>
          <p class="mt-2"><span class="font-medium">Reported On:</span> <span class="text-gray-900">17 Sept 2025, 10:28 AM</span></p>
          <p class="mt-2"><span class="font-medium">Contact:</span> <span class="text-gray-900">+91 99887 77665</span></p>
        </div>
      </div>

      <!-- Description box -->
      <div class="relative bg-gray-50 rounded-xl border border-gray-100 p-5 text-gray-800 leading-relaxed">
        <div id="descText" class="text-lg max-h-40 overflow-hidden transition-all">
          <!-- put the full description content here -->
          <p>
            Our dinner order — placed at 7:30 PM — arrived very late (after 2 hours). Several items were missing,
            and the delivered food was cold. I called room service twice and got no ETA. This caused significant
            inconvenience to our family and we missed our planned schedule for the evening. Please escalate to
            kitchen and service manager. Prefer a follow-up by phone and confirmation of refund/compensation.
          </p>
          <p class="mt-3">
            Additional notes: we had a toddler and the delay affected feeding times. Request housekeeping to check
            if a replacement tray can be arranged, and internal feedback to the team about communication protocols.
          </p>
        </div>

        <!-- fade overlay shown only when content is collapsed -->
        <div id="descFade" class="pointer-events-none absolute left-0 right-0 bottom-0 h-16 bg-gradient-to-t from-white to-transparent rounded-b-xl"></div>

        <!-- show more/less -->
        <div class="mt-4 flex items-center gap-3">
          <button id="toggleDescBtn" class="text-sm text-yellow-700 font-medium hover:underline">Show more</button>
          <span class="text-sm text-gray-500">•</span>
          <span class="text-sm text-gray-500">Last updated: 18 Sept 2025</span>
        </div>
      </div>
    </div>


  </div>
</section>

<!-- toggle script -->
<script>
  (function () {
    const desc = document.getElementById('descText');
    const fade = document.getElementById('descFade');
    const btn = document.getElementById('toggleDescBtn');

    // if description shorter than collapsed height, hide fade & button
    function isOverflowing(el) {
      return el.scrollHeight > el.clientHeight + 4; // small tolerance
    }

    function updateUI() {
      if (isOverflowing(desc)) {
        fade.style.display = ''; // show
        btn.style.display = '';
      } else {
        fade.style.display = 'none';
        btn.style.display = 'none';
      }
    }

    // initial
    updateUI();

    let expanded = false;
    btn.addEventListener('click', () => {
      expanded = !expanded;
      if (expanded) {
        desc.style.maxHeight = desc.scrollHeight + 'px';
        fade.style.display = 'none';
        btn.textContent = 'Show less';
      } else {
        desc.style.maxHeight = '10rem'; // same as max-h-40 (~160px)
        fade.style.display = '';
        btn.textContent = 'Show more';
        // scroll into view (optional): keep top visible
        desc.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
      }
    });

    // recalc on window resize (in case wrapping changes)
    window.addEventListener('resize', updateUI);
  })();
</script>


<!-- ✅ Issue Media (functional lightbox with equal thumbnails + download + captions) -->
<section class="bg-white rounded-2xl border border-gray-200 p-6 shadow-md">
  <h3 class="text-lg font-semibold text-yellow-700 mb-4">Issue Media</h3>

  <!-- Thumbnails grid: each thumbnail has a fixed height and object-cover so all look equal -->
  <div id="issueMediaGrid" class="grid grid-cols-2 md:grid-cols-3 gap-4">
    <div class="overflow-hidden rounded-lg h-40">
      <img class="thumb w-full h-full object-cover rounded-lg cursor-pointer"
           src="../../assets/gym.png"
           data-large="../../assets/gym.png"
           alt="Gym area - equipment" data-index="0" loading="lazy">
    </div>

    <div class="overflow-hidden rounded-lg h-40">
      <img class="thumb w-full h-full object-cover rounded-lg cursor-pointer"
           src="../../assets/pool.jpg"
           data-large="../../assets/pool.jpg"
           alt="Pool area" data-index="1" loading="lazy">
    </div>

    <div class="overflow-hidden rounded-lg h-40">
      <img class="thumb w-full h-full object-cover rounded-lg cursor-pointer"
           src="../../assets/room1.jpg"
           data-large="../../assets/room1.jpg"
           alt="Room interior" data-index="2" loading="lazy">
    </div>
        <div class="overflow-hidden rounded-lg h-40">
      <img class="thumb w-full h-full object-cover rounded-lg cursor-pointer"
           src="../../assets/gym.png"
           data-large="../../assets/gym.png"
           alt="Gym area - equipment" data-index="0" loading="lazy">
    </div>

    <div class="overflow-hidden rounded-lg h-40">
      <img class="thumb w-full h-full object-cover rounded-lg cursor-pointer"
           src="../../assets/pool.jpg"
           data-large="../../assets/pool.jpg"
           alt="Pool area" data-index="1" loading="lazy">
    </div>

    <div class="overflow-hidden rounded-lg h-40">
      <img class="thumb w-full h-full object-cover rounded-lg cursor-pointer"
           src="../../assets/room1.jpg"
           data-large="../../assets/room1.jpg"
           alt="Room interior" data-index="2" loading="lazy">
    </div>
        <div class="overflow-hidden rounded-lg h-40">
      <img class="thumb w-full h-full object-cover rounded-lg cursor-pointer"
           src="../../assets/gym.png"
           data-large="../../assets/gym.png"
           alt="Gym area - equipment" data-index="0" loading="lazy">
    </div>

    <div class="overflow-hidden rounded-lg h-40">
      <img class="thumb w-full h-full object-cover rounded-lg cursor-pointer"
           src="../../assets/pool.jpg"
           data-large="../../assets/pool.jpg"
           alt="Pool area" data-index="1" loading="lazy">
    </div>

    <div class="overflow-hidden rounded-lg h-40">
      <img class="thumb w-full h-full object-cover rounded-lg cursor-pointer"
           src="../../assets/room1.jpg"
           data-large="../../assets/room1.jpg"
           alt="Room interior" data-index="2" loading="lazy">
    </div>

    <!-- add more thumbnails following same wrapper pattern -->
  </div>

  <!-- Lightbox modal (hidden by default) -->
  <div id="mediaLightbox" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/60 p-4">
    <div class="relative max-w-5xl w-full mx-auto lightboxContent">

      <!-- Close -->
      <button id="lightboxClose" class="absolute top-4 right-4 bg-white/90 rounded-full p-2 shadow hover:bg-white">
        <span class="material-icons text-gray-800">close</span>
      </button>

      <!-- Prev -->
      <button id="lightboxPrev" class="absolute left-2 top-1/2 -translate-y-1/2 bg-white/90 rounded-full p-2 shadow hover:bg-white">
        <span class="material-icons text-gray-800">chevron_left</span>
      </button>

      <!-- Next -->
      <button id="lightboxNext" class="absolute right-2 top-1/2 -translate-y-1/2 bg-white/90 rounded-full p-2 shadow hover:bg-white">
        <span class="material-icons text-gray-800">chevron_right</span>
      </button>

      <!-- Large image -->
      <div class="rounded-lg overflow-hidden bg-gray-100">
        <img id="lightboxImage" src="" alt="Preview" class="w-full max-h-[80vh] object-contain bg-black">
      </div>

      <!-- Caption / controls -->
      <div class="mt-3 flex items-center justify-between gap-4">
        <div id="lightboxCaption" class="text-sm text-gray-100"></div>

        <div class="flex items-center gap-3">
          <div id="lightboxCounter" class="text-sm text-gray-100/90"></div>
          <a id="lightboxDownload"
             class="inline-flex items-center gap-2 bg-white/90 text-gray-800 px-3 py-1 rounded hover:bg-white shadow"
             href="#" download>
            <span class="material-icons text-sm">download</span> Download
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Inline script to enable behavior -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const thumbs = Array.from(document.querySelectorAll('#issueMediaGrid .thumb'));
      const lightbox = document.getElementById('mediaLightbox');
      const lightboxImage = document.getElementById('lightboxImage');
      const closeBtn = document.getElementById('lightboxClose');
      const prevBtn = document.getElementById('lightboxPrev');
      const nextBtn = document.getElementById('lightboxNext');
      const captionEl = document.getElementById('lightboxCaption');
      const counterEl = document.getElementById('lightboxCounter');
      const downloadEl = document.getElementById('lightboxDownload');

      if (!thumbs.length) return;

      // Normalize images array
      const images = thumbs.map(t => ({
        large: t.dataset.large || t.src,
        thumb: t.src,
        alt: t.alt || ''
      }));

      let currentIndex = 0;

      function openLightbox(index) {
        currentIndex = index;
        updateLightbox();
        lightbox.classList.remove('hidden');
        // focus the close button for accessibility
        closeBtn.focus();
        // prevent body scrolling while modal open
        document.body.style.overflow = 'hidden';
      }

      function closeLightbox() {
        lightbox.classList.add('hidden');
        document.body.style.overflow = '';
      }

      function updateLightbox() {
        const img = images[currentIndex];
        // set image src (browser will cache)
        lightboxImage.src = img.large;
        lightboxImage.alt = img.alt;
        captionEl.textContent = img.alt;
        counterEl.textContent = `${currentIndex + 1} / ${images.length}`;
        // download link
        downloadEl.href = img.large;
        downloadEl.setAttribute('download', (img.alt || `image-${currentIndex+1}`).replace(/\s+/g, '-').toLowerCase());
      }

      function next() {
        currentIndex = (currentIndex + 1) % images.length;
        updateLightbox();
      }

      function prev() {
        currentIndex = (currentIndex - 1 + images.length) % images.length;
        updateLightbox();
      }

      // Thumbnail clicks + keyboard open
      thumbs.forEach((t, i) => {
        t.addEventListener('click', () => openLightbox(i));
        t.setAttribute('tabindex', '0');
        t.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' || e.key === ' ') openLightbox(i);
        });
      });

      // Buttons
      closeBtn.addEventListener('click', closeLightbox);
      nextBtn.addEventListener('click', (e) => { e.stopPropagation(); next(); });
      prevBtn.addEventListener('click', (e) => { e.stopPropagation(); prev(); });

      // Close when clicking outside the lightboxContent
      lightbox.addEventListener('click', (e) => {
        // if clicked the overlay (not the content)
        if (e.target === lightbox) closeLightbox();
      });

      // Keyboard navigation
      document.addEventListener('keydown', (e) => {
        if (lightbox.classList.contains('hidden')) return;
        if (e.key === 'Escape') closeLightbox();
        if (e.key === 'ArrowRight') next();
        if (e.key === 'ArrowLeft') prev();
      });

      // Swipe support for mobile on the displayed image
      let startX = null;
      lightboxImage.addEventListener('touchstart', (e) => {
        startX = e.touches[0].clientX;
      }, { passive: true });

      lightboxImage.addEventListener('touchend', (e) => {
        if (startX === null) return;
        const endX = (e.changedTouches && e.changedTouches[0].clientX) || 0;
        const diff = startX - endX;
        const threshold = 50;
        if (diff > threshold) next();
        else if (diff < -threshold) prev();
        startX = null;
      });

      // Prevent image drag (polish)
      lightboxImage.addEventListener('dragstart', e => e.preventDefault());
    });
  </script>
</section>


  <!-- ✅ Chat -->
<section class="bg-white rounded-2xl border border-gray-200 p-6 shadow-md">
    <h3 class="text-lg font-semibold text-yellow-700 mb-4">Chat with the Issue Raiser</h3>
    
    <!-- Chat Box -->
    <div class="bg-gray-50 rounded-xl border h-72 p-4 overflow-y-auto space-y-4">
      
      <!-- User message -->
      <div class="flex items-start gap-2">
        <div class="bg-yellow-100 text-gray-800 px-4 py-2 rounded-2xl max-w-xs shadow">
          <p>The AC isn’t working properly.</p>
          <span class="text-xs text-gray-500 block mt-1">10:30 AM</span>
        </div>
      </div>

      <!-- Support reply -->
      <div class="flex items-start gap-2 justify-end">
        <div class="bg-green-100 text-gray-800 px-4 py-2 rounded-2xl max-w-xs shadow">
          <p>We’ve noted this and will send maintenance shortly.</p>
          <span class="text-xs text-gray-500 block mt-1 text-right">10:32 AM</span>
        </div>
      </div>

      <!-- Another user message -->
      <div class="flex items-start gap-2">
        <div class="bg-yellow-100 text-gray-800 px-4 py-2 rounded-2xl max-w-xs shadow">
          <p>Thank you. Please send someone quickly.</p>
          <span class="text-xs text-gray-500 block mt-1">10:33 AM</span>
        </div>
      </div>

    </div>

    <!-- Input -->
    <div class="mt-4 flex gap-3">
      <input type="text" placeholder="Type your message..." 
             class="flex-1 border rounded-lg p-3 focus:ring-2 focus:ring-yellow-500">
      <button class="bg-yellow-600 hover:bg-yellow-700 text-white px-6 py-2 rounded-lg shadow">Send</button>
    </div>
  </section>

</main>

  </div>

  <!-- ✅ Footer -->
  <div id="footer"></div>

  <!-- ✅ Scripts -->
  <script>
    // Sidebar highlight for "My Issues"
    document.querySelectorAll("aside nav a").forEach(link => {
      if (link.textContent.trim() === "My Issues") {
        link.classList.add("text-yellow-700", "font-semibold");
      }
    });

  const isCustomerLoggedIn = localStorage.getItem("is_customer_logged_in") === "true";

// ✅ Navbar loader
fetch(isCustomerLoggedIn ? "../LoggedCustomerNavbar/index.html" : "../NotCustomerNavbar/index.html")
  .then(res => res.text())
  .then(data => {
    document.getElementById("navbar").innerHTML = data;

    // mobile menu toggle
    const menuBtn = document.getElementById("menuBtn");
    const mobileMenu = document.getElementById("mobileMenu");
    if (menuBtn && mobileMenu) {
      menuBtn.addEventListener("click", () => {
        mobileMenu.classList.toggle("open");
      });
    }

    // ✅ attach modal listeners AFTER navbar injected
    attachModalListeners();
  });

function attachModalListeners() {
  const modal = document.getElementById("bookingModal");
  const closeModal = document.getElementById("closeModal");
  const addRoomBtn = document.getElementById("addRoomBtn");
  const roomsContainer = document.getElementById("roomsContainer");

  const individualModeBtn = document.getElementById("individualModeBtn");
  const sameDatesBtn = document.getElementById("sameDatesBtn");
  const globalDates = document.getElementById("globalDates");

  if (!modal) return;

  // Open modal
  document.querySelectorAll(".bookingModal").forEach(btn => {
    btn.addEventListener("click", (e) => {
      e.preventDefault();
      modal.classList.remove("hidden");
      modal.classList.add("flex");
    });
  });

  // Close modal
  closeModal?.addEventListener("click", () => {
    modal.classList.add("hidden");
    modal.classList.remove("flex");
  });

  // Add counter listeners
  function addCounterListeners(roomDiv) {
    roomDiv.querySelectorAll(".increase").forEach(btn => {
      btn.addEventListener("click", () => {
        const input = btn.parentElement.querySelector("input");
        input.value = parseInt(input.value) + 1;
      });
    });
    roomDiv.querySelectorAll(".decrease").forEach(btn => {
      btn.addEventListener("click", () => {
        const input = btn.parentElement.querySelector("input");
        if (parseInt(input.value) > parseInt(input.min)) {
          input.value = parseInt(input.value) - 1;
        }
      });
    });
  }

  // ✅ Reindex rooms after add/remove
  function reindexRooms() {
    document.querySelectorAll(".room-card").forEach((room, index) => {
      room.querySelector(".room-title").textContent = `Room ${index + 1}`;
    });
  }

  // Add room
  addRoomBtn?.addEventListener("click", () => {
    const roomDiv = document.createElement("div");
    roomDiv.className = "room-card border p-5 rounded-xl mb-6 bg-gray-50 shadow-sm";
    roomDiv.innerHTML = `
      <!-- Row 1: Room no + type -->
      <div class="flex items-center justify-between mb-4">
        <h3 class="room-title font-semibold text-lg">Room</h3>
        <select class="border rounded-lg p-2 focus:ring-2 focus:ring-yellow-500">
          <option>Deluxe Room</option>
          <option>Executive Suite</option>
          <option>Presidential Suite</option>
        </select>
      </div>

      <!-- Row 2: Adults + Children -->
      <div class="grid grid-cols-2 gap-6 mb-4">
        <div class="flex items-center justify-between">
          <label class="text-sm font-medium">Adults</label>
          <div class="flex items-center space-x-3">
            <button class="decrease w-8 h-8 rounded-full bg-gray-200">−</button>
            <input type="number" value="1" min="1" class="w-12 text-center border rounded-md p-1">
            <button class="increase w-8 h-8 rounded-full bg-yellow-500 text-white">+</button>
          </div>
        </div>
        <div class="flex items-center justify-between">
          <label class="text-sm font-medium">Children</label>
          <div class="flex items-center space-x-3">
            <button class="decrease w-8 h-8 rounded-full bg-gray-200">−</button>
            <input type="number" value="0" min="0" class="w-12 text-center border rounded-md p-1">
            <button class="increase w-8 h-8 rounded-full bg-yellow-500 text-white">+</button>
          </div>
        </div>
      </div>

      <!-- ✅ Individual Dates -->
      <div class="room-dates grid grid-cols-2 gap-4 mb-2">
        <div>
          <label class="block text-sm font-medium mb-1">Check-in</label>
          <input type="date" class="check-in w-full border rounded-lg p-2 focus:ring-2 focus:ring-yellow-500">
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">Check-out</label>
          <input type="date" class="check-out w-full border rounded-lg p-2 focus:ring-2 focus:ring-yellow-500">
        </div>
      </div>
      <p class="dateError text-red-500 text-sm mb-2"></p>

      <button class="remove-room mt-2 text-sm text-red-500 hover:underline">Remove Room</button>
    `;

    roomsContainer.appendChild(roomDiv);

    addCounterListeners(roomDiv);

    // Remove room + reindex
    roomDiv.querySelector(".remove-room").addEventListener("click", () => {
      roomDiv.remove();
      reindexRooms();
    });

    reindexRooms();
  });

  // ✅ Toggle between individual and same dates
  individualModeBtn?.addEventListener("click", () => {
    document.querySelectorAll(".room-dates").forEach(d => d.classList.remove("hidden"));
    globalDates.classList.add("hidden");

    individualModeBtn.classList.add("bg-yellow-100", "text-yellow-700");
    sameDatesBtn.classList.remove("bg-yellow-100", "text-yellow-700");
    sameDatesBtn.classList.add("text-gray-600");
  });

  sameDatesBtn?.addEventListener("click", () => {
    document.querySelectorAll(".room-dates").forEach(d => d.classList.add("hidden"));
    globalDates.classList.remove("hidden");

    sameDatesBtn.classList.add("bg-yellow-100", "text-yellow-700");
    individualModeBtn.classList.remove("bg-yellow-100", "text-yellow-700");
    individualModeBtn.classList.add("text-gray-600");
  });

  // Init counters for first room
  addCounterListeners(document.querySelector(".room-card"));
  reindexRooms();
}
    // Footer load
    fetch("../CustomerFooter/index.html")
      .then(res => res.text())
      .then(data => { document.getElementById("footer").innerHTML = data; });
  </script>
</body>
</html>
