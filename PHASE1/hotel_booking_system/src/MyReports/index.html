<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LuxuryStay - My Reports</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>
<body class="bg-gray-50 flex flex-col min-h-screen">

  <!-- ‚úÖ Navbar -->
  <div id="navbar"></div>

  <!-- ‚úÖ Layout -->
  <div class="flex flex-1 max-w-7xl mx-auto w-full py-8 px-4 lg:px-8 gap-8 mt-20">

    <!-- ‚úÖ Sidebar -->
    <aside class="w-64 bg-white shadow-lg rounded-2xl p-6 h-fit">
      <nav class="space-y-4 text-gray-700 font-medium">
        <a href="../MainPageCustomer/index.html" data-page="dashboard" class="block py-2 border-b hover:text-yellow-600">Overview</a>
        <a href="../MyBookings/index.html" data-page="booking" class="block py-2 border-b hover:text-yellow-600">Bookings</a>
        <a href="../SavedRoomsCustomer/index.html" data-page="saved" class="block py-2 border-b hover:text-yellow-600">Wishlist</a>
        <a href="../MyIssues/index.html" data-page="issues" class="block py-2 border-b hover:text-yellow-600">My Issues</a>
        <a href="../MyRefunds/index.html" data-page="refunds" class="block py-2 border-b hover:text-yellow-600">My Refunds</a>
        <a href="../ProfileDisplayCustomer/index.html" data-page="profile" class="block py-2 border-b hover:text-yellow-600">Profile</a>
        <a href="../MyReports/index.html" data-page="report" class="block py-2 border-b hover:text-yellow-600">Reports</a>
      </nav>
    </aside>

    <!-- ‚úÖ Main Content -->
    <main class="flex-1 space-y-10">

      <!-- ‚úÖ Header -->
      <div class="relative rounded-2xl p-[3px] bg-gradient-to-r from-yellow-600 to-red-700 shadow">
        <div class="bg-[#fdfaf4] rounded-2xl py-8 text-center">
          <h2 class="text-4xl text-gray-800 font-bold" style="font-family: 'Pacifico', cursive;">
            My Reports
          </h2>
          <p class="mt-2 text-gray-600">Download and review your personal data reports</p>
        </div>
      </div>

      <!-- ‚úÖ Categories -->
      <section>
        <h2 class="text-xl font-semibold text-gray-800 mb-6">Report Categories</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">

          <!-- Bookings -->
          <div>
            <h3 class="font-semibold text-gray-900 mb-3">üìë Bookings</h3>
            <ul class="space-y-2 text-blue-600 text-sm">
              <li><button class="reportBtn hover:underline" data-type="activeBookings">Active Bookings</button></li>
              <li><button class="reportBtn hover:underline" data-type="cancelledBookings">Cancelled Bookings</button></li>
              <li><button class="reportBtn hover:underline" data-type="bookingHistory">Booking History</button></li>
            </ul>
          </div>

          <!-- Payments -->
          <div>
            <h3 class="font-semibold text-gray-900 mb-3">üí≥ Payments</h3>
            <ul class="space-y-2 text-blue-600 text-sm">
              <li><button class="reportBtn hover:underline" data-type="paymentsMade">Payments Made</button></li>
              <li><button class="reportBtn hover:underline" data-type="paymentHistory">Payment History</button></li>
            </ul>
          </div>

          <!-- Refunds -->
          <div>
            <h3 class="font-semibold text-gray-900 mb-3">üí∏ Refunds</h3>
            <ul class="space-y-2 text-blue-600 text-sm">
              <li><button class="reportBtn hover:underline" data-type="refundHistory">Refund History</button></li>
            </ul>
          </div>

          <!-- Issues -->
          <div>
            <h3 class="font-semibold text-gray-900 mb-3">‚ö†Ô∏è Issues</h3>
            <ul class="space-y-2 text-blue-600 text-sm">
              <li><button class="reportBtn hover:underline" data-type="raisedIssues">Raised Issues</button></li>
              <li><button class="reportBtn hover:underline" data-type="resolvedIssues">Resolved Issues</button></li>
            </ul>
          </div>

        </div>
      </section>

      <!-- ‚úÖ Filters -->
      <div id="filtersSection" class="bg-white p-4 rounded-xl shadow flex flex-wrap items-center gap-4">
        <div class="flex items-center gap-2">
          <label for="fromDate" class="text-sm font-medium text-gray-700">From</label>
          <input type="date" id="fromDate" class="border rounded-lg p-2 focus:ring-2 focus:ring-yellow-500 text-sm">
        </div>
        <div class="flex items-center gap-2">
          <label for="toDate" class="text-sm font-medium text-gray-700">To</label>
          <input type="date" id="toDate" class="border rounded-lg p-2 focus:ring-2 focus:ring-yellow-500 text-sm">
        </div>
        <button id="applyFilter" class="px-5 py-2 bg-gradient-to-r from-yellow-500 to-red-500 text-white rounded-lg text-sm font-medium shadow hover:opacity-90">
          Apply Filter
        </button>
      </div>

      <!-- ‚úÖ Report Preview -->
      <section id="reportSection" class="hidden">
        <div class="bg-white p-6 rounded-xl shadow">
          <div class="flex justify-between items-center mb-4">
            <h2 id="reportTitle" class="text-lg font-semibold">Report Preview</h2>
            <div class="flex space-x-3">
              <button onclick="downloadCSV()" class="flex items-center gap-2 px-4 py-2 border border-blue-500 text-blue-600 rounded-lg text-sm font-medium hover:bg-blue-50">
                <span class="material-icons text-sm">file_download</span> CSV
              </button>
              <button onclick="downloadExcel()" class="flex items-center gap-2 px-4 py-2 border border-green-500 text-green-600 rounded-lg text-sm font-medium hover:bg-green-50">
                <span class="material-icons text-sm">file_download</span> Excel
              </button>
              <button onclick="downloadPDF()" class="flex items-center gap-2 px-4 py-2 border border-red-500 text-red-600 rounded-lg text-sm font-medium hover:bg-red-50">
                <span class="material-icons text-sm">picture_as_pdf</span> PDF
              </button>
            </div>
          </div>
          <div class="overflow-x-auto">
            <table id="reportTable" class="min-w-full border border-gray-200 rounded-lg">
              <thead class="bg-gray-100">
                <tr id="reportHeader"></tr>
              </thead>
              <tbody id="reportBody" class="divide-y divide-gray-200"></tbody>
            </table>
          </div>
        </div>
      </section>

    </main>
  </div>

  <!-- ‚úÖ Footer -->
  <div id="footer"></div>

  <!-- ‚úÖ Scripts -->
  <script>
    // Navbar + Footer load
    const isCustomerLoggedIn = localStorage.getItem("is_customer_logged_in") === "true";
    fetch(isCustomerLoggedIn ? "../LoggedCustomerNavbar/index.html" : "../NotCustomerNavbar/index.html")
      .then(res => res.text()).then(data => { document.getElementById("navbar").innerHTML = data; });
    fetch("../CustomerFooter/index.html").then(res => res.text()).then(data => { document.getElementById("footer").innerHTML = data; });

    // ‚úÖ Sidebar highlight
    document.querySelectorAll("aside nav a").forEach(link => {
      if (link.dataset.page === "report") {
        link.classList.add("text-yellow-700", "font-semibold");
      }
    });

    // ‚úÖ Dummy Data
    const reportsData = {
      activeBookings: [
        { id: "B001", date: "2025-09-20", room: "Deluxe", status: "Active", amount: "‚Çπ9,999" }
      ],
      cancelledBookings: [
        { id: "B002", date: "2025-09-15", room: "Suite", status: "Cancelled", amount: "‚Çπ0" }
      ],
      bookingHistory: [
        { id: "B003", date: "2025-08-10", room: "Executive", status: "Completed", amount: "‚Çπ7,500" }
      ],
      paymentsMade: [
        { id: "P001", date: "2025-09-20", method: "UPI - GPay", status: "Success", amount: "‚Çπ9,999" }
      ],
      paymentHistory: [
        { id: "P002", date: "2025-08-15", method: "Card - HDFC", status: "Success", amount: "‚Çπ7,500" }
      ],
      refundHistory: [
        { id: "R001", date: "2025-09-18", bookingId: "B002", status: "Processed", amount: "‚Çπ2,000" }
      ],
      raisedIssues: [
        { id: "I001", date: "2025-09-12", issue: "Late Check-in", status: "Open" }
      ],
      resolvedIssues: [
        { id: "I002", date: "2025-08-22", issue: "WiFi Issue", status: "Resolved" }
      ]
    };

    // Report click
    document.querySelectorAll(".reportBtn").forEach(btn => {
      btn.addEventListener("click", () => {
        const type = btn.dataset.type;
        const data = reportsData[type];
        document.getElementById("reportSection").classList.remove("hidden");
        document.getElementById("reportTitle").textContent = btn.textContent;
        renderTable(data);
      });
    });

    // Render table
    function renderTable(data) {
      const headerRow = document.getElementById("reportHeader");
      const body = document.getElementById("reportBody");
      headerRow.innerHTML = "";
      body.innerHTML = "";

      const headers = Object.keys(data[0]);
      headers.forEach(h => {
        const th = document.createElement("th");
        th.className = "px-4 py-2 text-left text-sm font-semibold text-gray-600";
        th.textContent = h.toUpperCase();
        headerRow.appendChild(th);
      });

      data.forEach(row => {
        const tr = document.createElement("tr");
        headers.forEach(h => {
          const td = document.createElement("td");
          td.className = "px-4 py-2 text-sm text-gray-700";
          td.textContent = row[h];
          tr.appendChild(td);
        });
        body.appendChild(tr);
      });
    }

    // ‚úÖ Export Functions
    function downloadCSV() {
      const table = document.getElementById("reportTable");
      let csv = [];
      for (let row of table.rows) {
        let cols = [];
        for (let cell of row.cells) cols.push(cell.innerText);
        csv.push(cols.join(","));
      }
      const blob = new Blob([csv.join("\n")], { type: "text/csv" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "report.csv";
      link.click();
    }

    function downloadExcel() {
      const wb = XLSX.utils.table_to_book(document.getElementById("reportTable"));
      XLSX.writeFile(wb, "report.xlsx");
    }

    function downloadPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      doc.text("My Report", 20, 20);
      doc.autoTable({ html: "#reportTable" });
      doc.save("report.pdf");
    }
  </script>
</body>
</html>
